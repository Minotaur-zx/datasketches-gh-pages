# Data collection

### Getting the Nodes & Links
I did the data preparation in R as usual. Family trees are something for a network layout, so the odd ".ged" format had to be transformed into a nodes & links file that d3's force layout knows how to handle. A node file where each node (here a person) would be on 1 line with all of their attributes in the columns, such as name, title, date of birth, but also some unique id to reference in the links file. The links file contains information about the connections between nodes. It typically has a source & target columns, which contain the id's of the nodes between which a line should run. You can also add more attributes to these rows, such as the type of connection (e.g. "mother-child", "wife-husband").

The original file contains information about the persons self: a unique id, the name, the title, birth date & death date (and location). However most people did not have all of this information, some just had a name and death date. The file also contained identifiers for families. Each family (a husband & wife combination, often with children as well) also had it's own unique id. By using the connections between the family id's and the person id's I could build up the information of the network, who was connected to who. But due to the somewhat odd (but luckily, still structured) format of the original file I decided to get out the information through a rather long for loop, including many if-else check to see what each line of the file had in terms of information.

#### Trying out family nodes
At first I connected people directly to each other, so children to their parents, but also to their own eventual children and spouse. During early development of the network I felt that this was creating too many lines. Therefore I switched to creating "family nodes". Each person in a family would then not be linked to their spouse and children, but to a new node representing the family (I hope that made sense). But sometime later, when I was getting to grips with the network more I found that it actually was a bit difficult to grasp, so I changed back again :)

Calculating those node & links files was all I did beforehand. But while wrangling my way through d3's force layout I thought about new things to add or values to pre-calculate to get more insights from the structure of the network.

#### Estimating birth year
I didn't want to have a hairball network and there's some really interesting information in the data to pull apart connections: year of birth (or death). However, this wasn't know for everybody. Thankfully I didn't need to have a perfect date, just somewhere in the right vicinity/century. I therefore wrote a small script that tries to find a good guess; either by looking if the death date of a person is know (and then subtracting 60 years), or looking at the birth or death date of the spouse, children or parents, in that order (again subtracting or adding some years to account for generational differences). This gave me an estimate for 95% of the people, for the remaining 20 people I just reran the loop, thus making an estimate based on estimates, but for 20 people that was fine (I eventually threw them out anyway when I only kept the people born after 1000 AD).

#### Calculating distances to royals
My final addition to the data was to calculate the smallest distance to a royal. There are still 10 royal hereditary families in Europe. I looked up the unique id for each of the current royal leaders and then I created 10 new columns in the nodes file, one for each royal, that would then contain the distance of a person to each of the 10 royals. When you hover over a royal in the visual, I can immediately show their closest connections, while for other people there is a bit of a lag due to calculation time of the distances. 

In the visual the 10 royals are positioned in a specific  horizontal order, placing royals together that are relatively closely related. For each person I also calculated to which royal they were most closely related. This would be used in the network to generate a weak force that would gather people under the royal that they are closest to (and thus for ties I used an average of the positions in the chart).
